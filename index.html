<!DOCTYPE html>
<html>
<head>
    <title>M-Test Acupuncture Application</title>
    
    <!-- The Web Marmalade library must be loaded before any scripts that call its methods. To be safe, load it in the page head -->
    <script type="text/javascript" charset="utf-8" src="wm.js"></script>
    
    <script type="text/javascript" charset="utf-8" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.21/jquery-ui.min.js"></script>
    
    <script type="text/javascript" charset="utf-8" src="db_patient.js"></script>
    
    <link rel="stylesheet" href="style.css" type="text/css" media="all" />
    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.21/themes/cupertino/jquery-ui.css" type="text/css" media="all" />
    
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1"/>
    <meta name="format-detection" content="telephone=no" />   
</head>
<body>
  	<div id="YourPageContainer">
		<div class="patient_sheet">
	      	<div class="patient_mtest_header">
	      		M-Test (Meridian Test) <br />
	      		by Yoshito Mukaino, M.D.
	      	</div>
	      	<div id="new_patient_button" class="patient_button"><img src="button_new_patient.png"></div>
	      	<div id="existing_patient_button" class="patient_button"><img src="button_existing_patient.png"></div>
		</div>
	</div>

	<div id="new_patient_dialog" style="display:none">
		<div class="patient_info_header">Patient Information</div>
		<div id="form1" class="form_container">
			<!--Onfocus events prevent scrolling when input clicked--> 
			<!--(iOS wants to scroll b/c KB decreases effective window height)-->
			<fieldset class="image_fieldset">
				<img src="patient_photo.png">
			</fieldset>
			<fieldset>
				<p class="first">
					<label for="name">First Name</label>
					<input type="text" name="firstname" id="firstname" onfocus="window.scrollTo(0, 0);"/>
				</p>
				<p>
					<label for="phone">Phone Number</label>
					<input type="text" name="phone" id="phone" onfocus="window.scrollTo(0, 0);"/>
				</p>				
				<p>
					<label for="dob">Date of Birth</label>
					<input type="text" name="dob" id="dob" placeholder="(MM/DD/YYYY)" onfocus="window.scrollTo(0, 0);"/>
				</p>											
			</fieldset>
			<fieldset>																		
				<p>
					<label for="email">Last Name</label>
					<input type="text" name="lastname" id="lastname" onfocus="window.scrollTo(0, 0);"/>
				</p>							
				<p>
					<label for="email">E-Mail Address</label>
					<input type="text" name="email" id="email" onfocus="window.scrollTo(0, 0);"/>
				</p>	
				<p>
					<label for="sex">Sex</label>
					<label for="male" class="radio_label">Male</label>
					<input type="radio" id="male" name="sex" value="male" onfocus="window.scrollTo(0, 0);"/>
					<label for="female" class="radio_label">Female</label>
					<input type="radio" id="female" name="sex" value="female" onfocus="window.scrollTo(0, 0);"/>
				</p>											
			</fieldset>
			<fieldset class="large_fieldset">
				<p>
					<label for="disorder">Disorder</label>
					<input type="text" class="large_input" name="disorder" id="disorder" onfocus="window.scrollTo(0, 0);"/>
				</p>
				<p>
					<label for="chiefcomplaint">Chief Complaint</label>
					<input type="text" class="large_input" name="chiefcomplaint" id="chiefcomplaint" onfocus="window.scrollTo(0, 0);" />
				</p>
				<p>
					<label for="notes">Notes</label>
					<textarea name="notes" id="notes" cols="50" rows="3" onfocus="window.scrollTo(0, 0);"></textarea>
				</p>				
			</fieldset>																										
		</div>
	</div>

  <!-- Load your app script here. -->
  <script type="text/javascript" charset="utf-8">
    
    // The entry point for your app
    function onDeviceReady() {
      	// Now safe to use the Web Marmalade API
      	
      	//Prevent scrolling when dialog pops up
      	document.addEventListener('touchmove', function(e) { e.preventDefault(); }, false);
      
      	initPatientDatabase();
      
      
        //Open dialog if "new patient" button clicked
		$("#new_patient_button").click(function(event) {
			popUpDialog(this.className, this.id);
    	})
    	
    	//Open sheet.html if "existing patient" button clicked
		$("#existing_patient_button").click(function(event) {
			window.location="sheet.html"
    	})
    	
    }
    

    function popUpDialog(the_class, the_id) {
    	
    	$("#new_patient_dialog").dialog({
	     	modal: true,
	     	height: 650,
	     	width: 700,
	     	resizable: false,
    		buttons: [{
        		text: "OK", 
        		id: "btnOk",
        		click: function () {
            		//$(this).dialog('close');

            		writePatientToDb(document.getElementById('firstname').value, document.getElementById('lastname').value, document.getElementById('dob').value, getSex());
            		//window.location="sheet.html";
            		//getPatientNameActual();
        		}, }, {
        		text: "Cancel",
        		click: function () {
            		$(this).dialog('close');
        		},
    		}]
	     });
	     
	     $('.ui-dialog').css("top","50px"); //keeps dialog at top of screen to avoid keyboard
	     
	     //$('.ui-dialog-title').hide(); //hides title but keeps thin bar with 'X' close button
	     $('.ui-widget-header').hide(); //completely hides title bar
         $('.ui-dialog :button').blur(); // Remove focus on all buttons within the div class ui-dialog
         $('.ui-dialog :input').blur(); // Remove initial focus on input elements within the div class ui-dialog KEEP THIS LINE OR NO?
         
         //getPatientName();
	}

	function writePatientToDb(first, last, dob, sex) {
		alert (first + last + dob + sex);
	}

	function getSex(){
        var sex;
		if(document.getElementById('male').checked)
			sex = 'M'; //Male radio button is checked 
		else if(document.getElementById('female').checked)
			sex = 'F'; //Female is checked
		else 
			sex = 'X'; //Neither is checked
		return sex;
	}

  </script>
  
  <!-- Set the event listener that signals initialisation complete. Your app can now be run. -->
  <script>document.addEventListener("deviceready", onDeviceReady, false);
  	//onDeviceReady();
  </script>
  
</body>
</html>